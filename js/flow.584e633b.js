(function(e){function t(t){for(var s,n,r=t[0],l=t[1],d=t[2],c=0,h=[];c<r.length;c++)n=r[c],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&h.push(a[n][0]),a[n]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);u&&u(t);while(h.length)h.shift()();return o.push.apply(o,d||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],s=!0,n=1;n<i.length;n++){var r=i[n];0!==a[r]&&(s=!1)}s&&(o.splice(t--,1),e=l(l.s=i[0]))}return e}var s={},n={flow:0},a={flow:0},o=[];function r(e){return l.p+"js/"+({}[e]||e)+"."+{"chunk-17c439e2":"8c842152","chunk-4dd2ba22":"15cf1283"}[e]+".js"}function l(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(e){var t=[],i={"chunk-17c439e2":1,"chunk-4dd2ba22":1};n[e]?t.push(n[e]):0!==n[e]&&i[e]&&t.push(n[e]=new Promise((function(t,i){for(var s="css/"+({}[e]||e)+"."+{"chunk-17c439e2":"56eec37e","chunk-4dd2ba22":"b1f5557c"}[e]+".css",a=l.p+s,o=document.getElementsByTagName("link"),r=0;r<o.length;r++){var d=o[r],c=d.getAttribute("data-href")||d.getAttribute("href");if("stylesheet"===d.rel&&(c===s||c===a))return t()}var h=document.getElementsByTagName("style");for(r=0;r<h.length;r++){d=h[r],c=d.getAttribute("data-href");if(c===s||c===a)return t()}var u=document.createElement("link");u.rel="stylesheet",u.type="text/css",u.onload=t,u.onerror=function(t){var s=t&&t.target&&t.target.src||a,o=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=s,delete n[e],u.parentNode.removeChild(u),i(o)},u.href=a;var p=document.getElementsByTagName("head")[0];p.appendChild(u)})).then((function(){n[e]=0})));var s=a[e];if(0!==s)if(s)t.push(s[2]);else{var o=new Promise((function(t,i){s=a[e]=[t,i]}));t.push(s[2]=o);var d,c=document.createElement("script");c.charset="utf-8",c.timeout=120,l.nc&&c.setAttribute("nonce",l.nc),c.src=r(e);var h=new Error;d=function(t){c.onerror=c.onload=null,clearTimeout(u);var i=a[e];if(0!==i){if(i){var s=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+s+": "+n+")",h.name="ChunkLoadError",h.type=s,h.request=n,i[1](h)}a[e]=void 0}};var u=setTimeout((function(){d({type:"timeout",target:c})}),12e4);c.onerror=c.onload=d,document.head.appendChild(c)}return Promise.all(t)},l.m=e,l.c=s,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(i,s,function(t){return e[t]}.bind(null,s));return i},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/sf-vue/",l.oe=function(e){throw console.error(e),e};var d=window["webpackJsonp"]=window["webpackJsonp"]||[],c=d.push.bind(d);d.push=t,d=d.slice();for(var h=0;h<d.length;h++)t(d[h]);var u=c;o.push([2,"ant-design-vue","chunk-vendors"]),i()})({"07fc":function(e,t,i){"use strict";i("dc5a");var s=i("56cd"),n=(i("3b18"),i("f64c")),a=(i("5704"),i("b558")),o=(i("0032"),i("e32c")),r=(i("de6a"),i("9a63")),l=(i("8fb1"),i("0c63")),d=(i("c119"),i("d865")),c=(i("b97c"),i("7571")),h=(i("c68a"),i("0020")),u=(i("cd17"),i("ed3b")),p=(i("f2ef"),i("3af3")),f=(i("2ef0"),i("9839")),k=(i("6ba6"),i("5efb")),w=i("8bbf"),g=i.n(w);i("3aed");g.a.use(k["a"]),g.a.use(f["b"]),g.a.use(p["a"]),g.a.use(u["a"]),g.a.use(h["a"]),g.a.use(c["a"]),g.a.use(d["a"]),g.a.use(l["a"]),g.a.use(r["a"]),g.a.use(o["a"]),g.a.use(a["a"]),g.a.prototype.$confirm=u["a"].confirm,g.a.prototype.$message=n["a"],g.a.prototype.$notification=s["a"],g.a.prototype.$info=u["a"].info,g.a.prototype.$success=u["a"].success,g.a.prototype.$error=u["a"].error,g.a.prototype.$warning=u["a"].warning},2:function(e,t,i){e.exports=i("ef00")},"3cb8":function(e,t,i){},"3dfd":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},n=[],a=i("2877"),o={},r=Object(a["a"])(o,s,n,!1,null,null,null);t["a"]=r.exports},4360:function(e,t,i){"use strict";var s=i("8bbf"),n=i.n(s),a=i("5880"),o=i.n(a),r=i("b775");function l(e){return r["b"].get("/wx/get_user_info",{params:{code:e,agent:Object({NODE_ENV:"production",VUE_APP_PREVIEW:"true",VUE_APP_API_BASE_URL:"/api",VUE_APP_PAGES:"demo,flow,site",BASE_URL:"/sf-vue/"}).VUE_APP_WX_CP_AGENT}})}function d(e){return r["b"].get("/wx/user/get",{params:{userid:e}})}const c={state:{id:"",name:"",info:{}},mutations:{SET_ID:(e,t)=>{e.id=t},SET_NAME:(e,t)=>{e.name=t},SET_INFO:(e,t)=>{e.info=t}},actions:{GetUserId({dispatch:e,commit:t},i){return new Promise((t,s)=>{l(i).then(i=>{const s=i.data;e("GetUserInfo",s.userId),t(s)}).catch(e=>{s(e)})})},GetUserInfo({commit:e},t){return new Promise((i,s)=>{d(t).then(s=>{const a=s.data;n.a.ls.set("userId",t,864e5),e("SET_ID",t),e("SET_NAME",a.userName),e("SET_INFO",a),i(a)}).catch(e=>{s(e)})})},Logout({commit:e}){return new Promise(t=>{e("SET_ID",""),e("SET_NAME",""),e("SET_INFO",{}),n.a.ls.remove("userId")})}}};var h=c;n.a.use(o.a);t["a"]=new o.a.Store({state:{},mutations:{},actions:{},modules:{user:h},getters:{token:e=>e.user.token,userName:e=>e.user.name,userId:e=>e.user.id,userInfo:e=>e.user.info}})},5880:function(e,t){e.exports=Vuex},6389:function(e,t){e.exports=VueRouter},"8bbf":function(e,t){e.exports=Vue},"8d95":function(e,t){e.exports=VueStorage},"8fc4":function(e,t,i){"use strict";var s=i("3cb8"),n=i.n(s);n.a},b775:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return r}));var s=i("cebe"),n=i.n(s),a=i("8bbf"),o=i.n(a);const r=n.a.create({baseURL:"/api",timeout:6e3});r.interceptors.request.use(e=>{const t=o.a.ls.get("token");return t&&(e.headers["token"]=t),e}),r.interceptors.response.use(e=>e.data);const l={vm:{},install(e){e.axios=r,Object.defineProperties(e.prototype,{axios:{get:function(){return r}},$http:{get:function(){return r}}})}}},ca00:function(e,t,i){"use strict";function s(e,t){const i=[e.x,e.x+e.w,t.x,t.x+t.w];return i.sort((e,t)=>e-t),i[1]/2+i[2]/2}function n(e,t){const i=[e.y,e.y+e.h,t.y,t.y+t.h];return i.sort((e,t)=>e-t),i[1]/2+i[2]/2}i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return o})),i.d(t,"e",(function(){return r}));const a=e=>{const t=e.url,i=t.split("?")[1];return i?JSON.parse('{"'+decodeURIComponent(i).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'):{}};function o(e){const t=new Date(e),i=t.getFullYear(),s=("00"+(t.getMonth()+1)).slice(-2),n=("00"+t.getDate()).slice(-2),a=("00"+t.getHours()).slice(-2),o=("00"+t.getMinutes()).slice(-2),r=("00"+t.getSeconds()).slice(-2);return`${i}-${s}-${n} ${a}:${o}:${r}`}function r(e){const t=new Date(e),i=("00"+t.getHours()).slice(-2),s=("00"+t.getMinutes()).slice(-2),n=("00"+t.getSeconds()).slice(-2);return`${i}:${s}:${n}`}},cebe:function(e,t){e.exports=axios},ef00:function(e,t,i){"use strict";i.r(t);i("2d26"),i("96cf");var s=i("8bbf"),n=i.n(s),a=i("3dfd"),o=i("6389"),r=i.n(o);n.a.use(r.a);const l=[{path:"/flow/design",component:()=>i.e("chunk-17c439e2").then(i.bind(null,"b7e8"))},{path:"/flow/play",component:()=>i.e("chunk-4dd2ba22").then(i.bind(null,"d698"))}];const d=new r.a({mode:"history",base:"/sf-vue/",routes:l});var c=d,h=i("4360"),u=i("b775"),p=(i("dd48"),i("2fc4")),f=i("8d95"),k=i.n(f),w=(i("07fc"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sflow-wrapper",class:e.mode+"-mode"},[e.isDesignMode?i("div",{staticClass:"sflow-header"},[i("div",{staticClass:"sflow-tools"},e._l(e.tools,(function(t,s){return i("div",{key:"tool-"+s,staticClass:"tool",attrs:{title:t.name}},[e._t("tool",[i("a-icon",{class:["tool-icon",{disabled:t.disabled}],attrs:{type:t.icon},on:{click:function(i){return e.toolClick(t)}}})],{tool:t})],2)})),0),i("a-breadcrumb",{staticClass:"sflow-path",attrs:{separator:">"}},e._l(e.path,(function(t){return i("a-breadcrumb-item",{key:t.id},[e._v(e._s(t.name))])})),1)],1):e._e(),i("div",{staticClass:"sflow-body"},[e.isDesignMode?i("div",{staticClass:"sflow-sidebar"},[i("div",{staticClass:"sflow-opers"},[i("div",{staticClass:"oper",class:null===e.activeOper?"active":null,attrs:{title:"选择"},on:{click:function(t){return e.operClick(null)}}},[i("a-icon",{staticClass:"oper-icon",staticStyle:{transform:"rotate(-45deg)"},attrs:{type:"arrow-up"}}),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.sideBarCollapse,expression:"!sideBarCollapse"}],staticClass:"oper-name"},[e._v("选择")])],1),i("div",{staticClass:"oper",class:e.isDrawLink?"active":null,attrs:{title:"连线"},on:{click:function(t){return e.operClick("draw-link")}}},[i("a-icon",{staticClass:"oper-icon",attrs:{type:"rise"}}),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.sideBarCollapse,expression:"!sideBarCollapse"}],staticClass:"oper-name"},[e._v("连线")])],1)]),i("div",{staticClass:"sflow-items"},e._l(e.items,(function(t,s){return i("div",{key:"item-"+s,staticClass:"item",attrs:{title:t.name},on:{mousedown:function(i){return e.itemDragStart(t)}}},[i("a-icon",{staticClass:"item-icon",attrs:{type:t.icon?t.icon:"setting"}}),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.sideBarCollapse,expression:"!sideBarCollapse"}],staticClass:"item-name"},[e._v(e._s(t.name))])],1)})),0)]):e._e(),i("div",{ref:"flow",staticClass:"sflow-view",class:[e.isDrawLink?"draw-link":null,e.mode+"-mode"],on:{mousedown:e.handleDragStart,mousemove:e.handleDrag,mouseup:e.handleDragEnd,click:e.handleClick}},[i("div",{style:{height:"100%",transform:e.subSize?"translate("+e.subOffset.x+"px,"+e.subOffset.y+"px)":null}},[e.subSize?i("div",{staticClass:"sub-box",style:{width:e.subSize.w+"px",height:e.subSize.h+"px",zIndex:-100}}):e._e(),i("div",{staticClass:"link-layer"},[i("svg",[i("defs",[i("marker",{attrs:{id:"arrow",markerWidth:"10",markerHeight:"10",refX:"8",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse"}},[i("path",{staticClass:"link-marker-arrow",attrs:{d:"M0,8 L8,4 L0,0 z"}})]),i("marker",{attrs:{id:"arrow-warning",markerWidth:"10",markerHeight:"10",refX:"8",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse"}},[i("path",{staticClass:"link-marker-arrow-warning",attrs:{d:"M0,8 L8,4 L0,0 z"}})]),i("marker",{attrs:{id:"arrow-error",markerWidth:"10",markerHeight:"10",refX:"8",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse"}},[i("path",{staticClass:"link-marker-arrow-error",attrs:{d:"M0,8 L8,4 L0,0 z"}})]),i("marker",{attrs:{id:"arrow-init",markerWidth:"10",markerHeight:"10",refX:"8",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse"}},[i("path",{staticClass:"link-marker-arrow-init",attrs:{d:"M0,8 L8,4 L0,0 z"}})])]),e._l(e.links,(function(t){return i("g",{key:t.id},[i("path",{class:e.linkClassData(t),attrs:{d:t.path}}),e.isDesignMode?i("path",{staticClass:"link-selecter",attrs:{d:t.path},on:{click:function(i){return i.stopPropagation(),e.linkClick(t)},dblclick:function(i){return i.stopPropagation(),e.linkDblclick(t)}}}):e._e(),i("text",{staticClass:"link-name",attrs:{x:t.cx,y:t.cy,dy:"-4"}},[e._v(e._s(t.name)+" ")])])})),e.isDesignMode?i("path",{staticClass:"link-draw",attrs:{d:e.drawLinkPath}}):e._e()],2),e.isDesignMode?[i("div",{directives:[{name:"show",rawName:"v-show",value:e.activeLink,expression:"activeLink"}],staticClass:"link-tools",style:e.linkToolStyle},[i("div",{staticClass:"tool tool-v",on:{click:e.switchVLink}}),i("div",{staticClass:"tool tool-h",on:{click:e.switchHLink}}),i("div",{staticClass:"tool tool-l",on:{click:e.switchLLink}}),i("div",{staticClass:"tool tool-x",on:{click:e.deleteLink}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.activeLink,expression:"activeLink"}],staticClass:"link-drag",style:e.linkDragStyle,on:{mousedown:function(t){return t.preventDefault(),e.linkDragStart(t)}}})]:e._e()],2),i("div",{staticClass:"node-layer"},e._l(e.nodes,(function(t){return i("div",{key:t.id,class:e.nodeClassData(t),style:e.nodeStyle(t),on:{click:function(i){return i.stopPropagation(),e.nodeClick(t)},dblclick:function(i){return i.stopPropagation(),e.nodeDblclick(t)}}},[t.free?[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.free.show,expression:"!node.free.show"}],staticClass:"node-drag"},[i("a-icon",{staticClass:"node-icon",attrs:{type:t.icon?t.icon:"setting"}})],1),i("div",{staticClass:"node-inner"},[t.free.show?i("s-flow",{attrs:{nodes:t.free.nodes,links:t.free.links,"node-class":e.nodeClass,mode:"view"}}):i("div",[e._v(e._s(t.name))]),i("a-button",{staticClass:"free-flow-btn",attrs:{shape:"circle",icon:t.free.show?"minus":"plus",type:"primary"},on:{click:function(i){return e.showFreeFlow(t)}}})],1)]:t.sub?[i("div",{staticClass:"node-drag",on:{mousedown:function(i){return e.nodeDragStart(t,i)}}},[i("a-icon",{staticClass:"node-icon",attrs:{type:t.icon?t.icon:"setting"}})],1),i("div",{staticClass:"node-inner"},[t.sub?i("s-flow",{attrs:{nodes:t.sub.nodes,links:t.sub.links,"node-class":e.nodeClass,mode:"view"}}):e._e()],1)]:[i("div",{staticClass:"node-drag",on:{mousedown:function(i){return e.nodeDragStart(t,i)}}},[e._t("icon",[i("a-icon",{staticClass:"node-icon",attrs:{type:t.icon?t.icon:"setting"}})],{node:t})],2),i("div",{staticClass:"node-inner"},[e._t("node",[e._v(e._s(t.name))],{node:t})],2)],e.isDesignMode?[i("a-icon",{directives:[{name:"show",rawName:"v-show",value:e.activeNode===t.id,expression:"activeNode===node.id"}],staticClass:"node-close",attrs:{type:"close"},on:{click:e.deleteNode}}),i("a-icon",{directives:[{name:"show",rawName:"v-show",value:e.activeNode===t.id,expression:"activeNode===node.id"}],staticClass:"node-resize",attrs:{type:"arrows-alt"},on:{mousedown:function(i){return e.nodeResizeStart(t)}}})]:e._e()],2)})),0)])])])])}),g=[],m=i("ca00"),y=i("ec26"),v={name:"SFlow",data(){return{activeNode:null,dragNode:null,dragNodeX:0,dragNodeY:0,highlightNode:null,resizeNode:null,activeLink:null,dragLink:null,dragItem:null,dragItemNode:null,activeOper:null,drawLinkNode:null,drawLinkX:0,drawLinkY:0,drawLinkPath:null,flows:[],subOffset:{x:0,y:0}}},props:{nodes:{type:Array,default:()=>[]},links:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},tools:{type:Array,default:()=>[]},path:{type:Array,default:()=>[]},defaultNodeWidth:{type:Number,default:100},defaultNodeHeight:{type:Number,default:40},minNodeWidth:{type:Number,default:80},minNodeHeight:{type:Number,default:30},sideBarCollapse:{type:Boolean,default:!1},mode:{type:String,default:"design"},nodeClass:{type:[String,Function],default:"node"},linkClass:{type:[String,Function],default:"link"},subSize:{type:Object,default:()=>{}}},watch:{links(e){e.forEach(e=>{void 0===e.path&&this.handleLink(e)})},subSize(e){if(e){const t=this.$refs.flow.getBoundingClientRect();this.subOffset.x=(t.width-e.w)/2,this.subOffset.y=(t.height-e.h)/2}}},computed:{nodeMap(){const e={};return this.nodes.forEach(t=>{e[t.id]=t}),e},linkMap(){const e={};return this.links.forEach(t=>{e[t.id]=t}),e},itemMap(){const e={};return this.items.forEach(t=>{e[t.id]=t}),e},isDesignMode(){return"design"===this.mode},isPlayMode(){return"play"===this.mode},isViewMode(){return"view"===this.mode},linkToolStyle(){if(this.activeLink){const e=this.linkMap[this.activeLink];return{left:e.cx+"px",top:e.cy+4+"px"}}return null},linkDragStyle(){if(this.activeLink){const e=this.linkMap[this.activeLink],t=this.nodeMap[e.s],i=this.nodeMap[e.t];if("v"===e.way){const s=t.y+t.h/2,n=i.y+i.h/2;return{left:e.cx-5+"px",top:(s>n?n:s)+"px",width:"10px",height:(s>n?s-n:n-s)+"px",cursor:"e-resize"}}if("h"===e.way){const s=t.x+t.w/2,n=i.x+i.w/2;return{left:(s>n?n:s)+"px",top:e.cy-5+"px",width:(s>n?s-n:n-s)+"px",height:"10px",cursor:"n-resize"}}return{display:"none"}}return null},isDrawLink(){return"draw-link"===this.activeOper}},created(){this.links.forEach(e=>this.handleLink(e))},methods:{_getPosition(e){const t=this.$refs.flow.getBoundingClientRect();let i=e.clientX-t.left,s=e.clientY-t.top;return this.subSize&&(i-=this.subOffset.x,s-=this.subOffset.y),{ex:i,ey:s}},showFreeFlow(e){const t=e.free.w,i=e.free.h;e.free.w=e.w,e.free.h=e.h,e.w=t,e.h=i,e.free.show=!e.free.show},nodeStyle(e){return{left:e.x+"px",top:e.y+"px",width:e.w+"px",height:e.h+"px",minWidth:this.minNodeWidth+"px",minHeight:this.minNodeHeight+"px"}},nodeClassData(e){const t=[];return"function"===typeof this.nodeClass?t.push(this.nodeClass(e),"node"):"string"===typeof this.nodeClass&&t.push(this.nodeClass),this.isDesignMode?t.push({active:this.activeNode===e.id,highlight:this.highlightNode===e.id}):this.isPlayMode?(t.push(e.play),e.free&&t.push(e.free.show?"free-show":null)):this.isViewMode&&e.play&&t.push(e.play),t},nodeClick(e){this.isDesignMode&&(this.activeNode=e.id,this.activeLink=null),this.$emit("nodeClick",e)},nodeDblclick(e){this.$emit("nodeDblclick",e)},nodeDragStart(e,t){if(!this.isDrawLink){this.dragNode=e.id;const{ex:i,ey:s}=this._getPosition(t);this.dragNodeX=i-e.x,this.dragNodeY=s-e.y}},handleDragStart(e){if(this.isDesignMode&&this.isDrawLink&&this.highlightNode){this.drawLinkNode=this.highlightNode;const{ex:t,ey:i}=this._getPosition(e);this.drawLinkX=t,this.drawLinkY=i}},handleDrag(e){if(this.isDesignMode){const{ex:t,ey:i}=this._getPosition(e);if(this.dragNode){const e=this.nodeMap[this.dragNode];e.x=t-this.dragNodeX,e.y=i-this.dragNodeY,this.links.filter(e=>e.s===this.dragNode||e.t===this.dragNode).forEach(e=>{this.handleLink(e)})}if(this.resizeNode){const e=this.nodeMap[this.resizeNode],s=t+7-e.x,n=i+7-e.y;e.w=s>this.minNodeWidth?s:this.minNodeWidth,e.h=n>this.minNodeHeight?n:this.minNodeHeight,this.links.filter(e=>e.s===this.resizeNode||e.t===this.resizeNode).forEach(e=>{this.handleLink(e)})}if(this.dragLink){const e=this.linkMap[this.dragLink];"v"===e.way?e.cx=t:"h"===e.way&&(e.cy=i),this.handleLink(e)}if(this.isDrawLink){const e=this.nodes.find(e=>e.x<t&&e.x+e.w>t&&e.y<i&&e.y+e.h>i);this.highlightNode=e?e.id:null,this.drawLinkNode&&(this.drawLinkPath=`M ${this.drawLinkX} ${this.drawLinkY} L ${t} ${i}`)}if(this.dragItem){const e=this.itemMap[this.dragItem];this.dragItemNode?(this.dragItemNode.x=t-this.defaultNodeWidth/2,this.dragItemNode.y=i-this.defaultNodeHeight/2):(this.dragItemNode=Object.assign({},e,{id:"node_"+Object(y["a"])().replace(/-/g,""),x:t-this.defaultNodeWidth/2,y:i-this.defaultNodeHeight/2,w:this.defaultNodeWidth,h:this.defaultNodeHeight}),this.nodes.push(this.dragItemNode),this.$emit("nodeCreate",this.dragItemNode))}}},handleDragEnd(){if(this.isDesignMode){if(this.dragNode&&(this.dragNode=null),this.resizeNode&&(this.resizeNode=null),this.dragLink&&(this.dragLink=null),this.isDrawLink&&this.drawLinkNode){if(this.highlightNode&&!this.links.some(e=>e.s===this.drawLinkNode&&e.t===this.highlightNode)&&this.highlightNode!==this.drawLinkNode){const e={id:"link_"+Object(y["a"])().replace(/-/g,""),name:"",s:this.drawLinkNode,t:this.highlightNode,way:"l"};this.links.push(e),this.$emit("linkCreate",e),this.handleLink(e)}this.drawLinkNode=null,this.drawLinkPath=null}this.dragItem&&(this.dragItem=null,this.dragItemNode=null)}},handleClick(){this.activeLink&&(this.activeLink=null),this.activeNode&&(this.activeNode=null),this.$emit("viewClick")},deleteNode(){this.$emit("nodeDelete",this.activeNode),this.nodes.splice(this.nodes.findIndex(e=>e.id===this.activeNode),1);const e=this.links.filter(e=>e.s!==this.activeNode&&e.t!==this.activeNode);e.length>0&&this.links.splice(0,this.links.length,...e),this.activeNode=null},nodeResizeStart(e){this.resizeNode=e.id},linkClick(e){this.isDesignMode&&(this.activeLink=e.id,this.activeNode=null)},linkDblclick(e){this.$emit("linkDblclick",e)},linkClassData(e){const t=[];return"function"===typeof this.linkClass?t.push(this.linkClass(e),"link"):"string"===typeof this.linkClass&&t.push(this.linkClass),this.isDesignMode?t.push({active:this.activeLink===e.id}):this.isPlayMode&&t.push(e.play),t},calcLPath(e){const t=this.nodeMap[e.s],i=this.nodeMap[e.t],s=[],n=[];t.x>i.x+i.w?(s[0]=t.x,n[0]=i.x+i.w):t.x+t.w>i.x?s[0]=n[0]=Object(m["c"])(t,i):(s[0]=t.x+t.w,n[0]=i.x),t.y>i.y+i.h?(s[1]=t.y,n[1]=i.y+i.h):t.y+t.h>i.y?s[1]=n[1]=Object(m["d"])(t,i):(s[1]=t.y+t.h,n[1]=i.y),this.$set(e,"cx",s[0]/2+n[0]/2),this.$set(e,"cy",s[1]/2+n[1]/2),this.$set(e,"path",`M ${s[0]} ${s[1]} L ${n[0]} ${n[1]}`)},calcHPath(e){const t=this.nodeMap[e.s],i=this.nodeMap[e.t],s=e.cy?e.cy:Object(m["d"])(t,i),n=[];t.y>s?n.push([t.x+t.w/2,t.y],[t.x+t.w/2,s]):s>t.y+t.h?n.push([t.x+t.w/2,t.y+t.h],[t.x+t.w/2,s]):t.x+t.w/2>i.x+i.w/2?n.push([t.x,s]):n.push([t.x+t.w,s]),i.y>s?n.push([i.x+i.w/2,s],[i.x+i.w/2,i.y]):s>i.y+i.h?n.push([i.x+i.w/2,s],[i.x+i.w/2,i.y+i.h]):t.x+t.w/2<i.x+i.w/2?n.push([i.x,s]):n.push([i.x+i.w,s]);const a=n.filter(e=>e[1]===s);this.$set(e,"cx",a[0][0]/2+a[1][0]/2),this.$set(e,"cy",s),this.$set(e,"path","M "+n.map(e=>`${e[0]} ${e[1]}`).join(" L "))},calcVPath(e){const t=this.nodeMap[e.s],i=this.nodeMap[e.t],s=e.cx?e.cx:Object(m["c"])(t,i),n=[];t.x>s?n.push([t.x,t.y+t.h/2],[s,t.y+t.h/2]):s>t.x+t.w?n.push([t.x+t.w,t.y+t.h/2],[s,t.y+t.h/2]):t.y+t.h/2>i.y+i.h/2?n.push([s,t.y]):n.push([s,t.y+t.h]),i.x>s?n.push([s,i.y+i.h/2],[i.x,i.y+i.h/2]):s>i.x+i.w?n.push([s,i.y+i.h/2],[i.x+i.w,i.y+i.h/2]):t.y+t.h/2<i.y+i.h/2?n.push([s,i.y]):n.push([s,i.y+i.h]);const a=n.filter(e=>e[0]===s);this.$set(e,"cx",s),this.$set(e,"cy",a[0][1]/2+a[1][1]/2),this.$set(e,"path","M "+n.map(e=>`${e[0]} ${e[1]}`).join(" L "))},handleLink(e){e.way=e.way||"l","l"===e.way?this.calcLPath(e):"h"===e.way?this.calcHPath(e):"v"===e.way&&this.calcVPath(e)},switchVLink(){const e=this.linkMap[this.activeLink];"v"!==e.way&&(e.way="v",e.cx=null,this.handleLink(e))},switchHLink(){const e=this.linkMap[this.activeLink];"h"!==e.way&&(e.way="h",e.cy=null,this.handleLink(e))},switchLLink(){const e=this.linkMap[this.activeLink];"l"!==e.way&&(e.way="l",this.handleLink(e))},deleteLink(){this.links.splice(this.links.findIndex(e=>e.id===this.activeLink),1),this.activeLink=null},linkDragStart(){this.dragLink=this.activeLink},itemDragStart(e){this.dragItem=e.id,this.activeOper=null},operClick(e){this.activeOper=e,this.dragItem=null},toolClick(e){this.$emit("toolClick",e)}}},x=v,b=(i("8fc4"),i("2877")),N=Object(b["a"])(x,w,g,!1,null,null,null),C=N.exports;n.a.use(p["a"]),n.a.component(C.name,C),n.a.use(k.a,{namespace:"flow__",name:"ls",storage:"local"}),n.a.config.productionTip=!1,n.a.use(u["a"]),new n.a({router:c,store:h["a"],render:e=>e(a["a"])}).$mount("#app")}});